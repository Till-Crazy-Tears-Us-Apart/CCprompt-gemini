---
description: "在项目根目录生成一个临时的 .compact_args.md 文件，用于 /compact 指令。"
allowed-tools: Read, Grep, Glob, Bash
argument-hint: "[请在此简述本次会话的核心任务]"
---

你的任务是严格遵循以下三步流程，生成并写入 `.compact_args.md` 文件。

**【步骤一：事实快照】**
你**必须**首先执行以下命令，捕获文件状态。此输出是后续步骤的关键输入：
```bash
if git rev-parse --is-inside-work-tree > /dev/null 2>&1; then git status --short; else echo "--- Project File Structure ---"; find . -maxdepth 2; fi
```

**【步骤二：填充模板】**
基于**整个对话的上下文**和**步骤一的 Git 状态**，完整地填充下面的“引导摘要”模板。填充时，必须严格遵守每个章节下的【协议】。

**【步骤三：写入文件并终止】**
这是你的**最终行动**。使用下面提供的 Bash HEREDOC 命令，将填充好的**完整内容**写入文件。**写入操作完成后，你的任务即告完成，必须立即停止，不得进行任何后续的思考、确认或输出。**

---
### **引导摘要 (Boot-strapping Summary) - 模板**

**1. 核心任务与当前状态**
- **核心任务**: `$ARGUMENTS`
- **当前状态**: (请在这里详细描述项目在本次会话结束时的确切状态。)

**2. 文件状态快照 (自动生成)**
```
<-- 在这里插入文件状态快照的完整输出 -->
```

**3. 下一轮对话记忆恢复协议 (强制、严格按序执行)**
**【协议】**: 
1.  你**必须**将上方 `Git 状态快照` 中列出的**每一个文件**都整合到下面的分层阅读协议中。
2.  你**必须**严格按照以下分层、有序的结构，为新的会话实例规划一个完整的上下文重建流程。
3.  在规划时，你**必须**根据**步骤一的 `git status` 快照**和你的记忆，来判断 `ProjectOverview.md` 和 `README.md` 是否存在及其确切路径。

*   **第一步：阅读高层项目文档 (如果存在)**
    -   `[path/to]/ProjectOverview.md`: (理由：获取任务管线和项目概览)
    -   `[path/to]/README.md`: (理由：理解项目核心功能)

*   **第二步：阅读核心技术报告 (按重要性/时间倒序)**
    -   `task_reports/[最新的报告].md`: (理由：本次会话最直接的上下文)
    -   `task_reports/[次新的报告].md`: (理由：理解上一步的决策)
    -   **【警告】**: (在这里明确指出旧报告可能过时，应以最新信息为准)

*   **第三步：完整阅读所有非测试源代码**
    -   `src/`: (理由：重建对项目实现细节的完整认识)
    -   ...

*   **第四步：阅读其他必要的支持性代码**
    -   (例如 `CLAUDE.md` 或关键的测试文件)

**4. 必须保留的技术细节与方案**
**【协议】**: 
1. **无损交接原则 (Lossless Handover Principle)**: 此部分的目标是**零信息丢失**。你必须将其视为一次完整的“会话状态序列化”，而非“摘要”。你的专业声誉取决于下一个会话实例能否在**不阅读本轮完整对话**的情况下，仅凭此部分就无缝衔接工作。
2. **禁止信息压缩**: **严禁**对任何技术细节、逻辑链条、设计决策、API签名、数据结构、错误分析或修复步骤进行任何形式的**概括、简化或总结**。必须以**复述和引用的方式**，完整地保留所有关键信息。
3. **自我验证清单**: 在完成本节前，你必须在内部进行一次自我验证，确认以下信息类别均已得到完整保留，无一遗漏：[ ] 架构决策与理由, [ ] 关键算法与实现逻辑, [ ] API/数据结构定义, [ ] Bug的根本原因分析, [ ] 失败的尝试及其教训, [ ] 最终的修复方案与验证过程。

- **架构/设计模式**: (详述...)
- **关键实现**: (详述...)
- **重要Bug修复**: (详述...)
- ...

**5. 后续行动协议 (Next Action Protocol)**
**【协议】**:
**上下文同步与授权工作流 (Context Sync & Authorization Workflow)**: 新的会话实例**必须**严格遵循以下流程，不得跳过任何步骤：
1.  **上下文加载**: **严格按照**上方“记忆恢复协议”定义的**分层、有序**的流程，阅读所有指定文件。
2.  **理解陈述**: 向用户简洁地复述其对 [1. 核心任务, 2. 当前状态, 3. 下一步行动] 的理解，并明确重申相关的**子任务管线**（如果存在）。
3.  **强制等待授权**: 在完成理解陈述后，**必须**停止所有主动行为，并明确请求用户的授权才能继续。**严禁在获得用户明确的‘同意’、‘继续’或类似指令前，创建ToDo List或执行任何工具调用。**
4.  **授权后行动**: 只有在获得用户授权后，才能开始执行下一步任务：(在这里明确指出具体的下一步任务)

---
### **Bash 写入命令结构 (必须使用)**

```bash
cat <<'EOF' > .compact_args.md
<-- 在这里插入你填充好的完整 Markdown 内容 -->
EOF
```

---
**IMPORTANT**: After executing the Bash command to write the file, your task is complete. You MUST output the following confirmation message and nothing else: "`.compact_args.md` file has been successfully generated."