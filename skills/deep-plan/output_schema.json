{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Deep Plan Audit Output",
  "type": "object",
  "required": ["ambiguity_resolution", "pbt_specs", "logic_audit", "physical_changes"],
  "properties": {
    "ambiguity_resolution": {
      "type": "array",
      "description": "Table 1: 歧义消除矩阵 (Ambiguity Resolution Matrix)",
      "items": {
        "type": "object",
        "required": ["ambiguity", "options", "fixed_constraint", "rationale"],
        "properties": {
          "ambiguity": { "type": "string", "description": "决策点/模糊项" },
          "options": { "type": "string", "description": "可选方案" },
          "fixed_constraint": { "type": "string", "description": "最终锁定约束" },
          "rationale": { "type": "string", "description": "锁定理由" }
        }
      }
    },
    "pbt_specs": {
      "type": "array",
      "description": "Table 2: PBT 属性规约 (Property-Based Testing Spec)",
      "items": {
        "type": "object",
        "required": ["module", "property_type", "invariant", "falsification_strategy"],
        "properties": {
          "module": { "type": "string", "description": "功能模块" },
          "property_type": { "type": "string", "enum": ["Idempotency", "Round-trip", "Invariant Preservation", "Commutativity", "Bounds", "State Machine"], "description": "PBT 属性类型" },
          "invariant": { "type": "string", "description": "数学不变量描述 (e.g. f(x) > 0)" },
          "falsification_strategy": { "type": "string", "description": "证伪/测试策略" }
        }
      }
    },
    "logic_audit": {
      "type": "array",
      "description": "Table 3: 逻辑与契约审计表",
      "items": {
        "type": "object",
        "required": ["dimension", "check_item", "status", "contract"],
        "properties": {
          "dimension": {
            "type": "string",
            "enum": [
              "数据流 (Data Flow)",
              "一致性 (Consistency)",
              "数据结构 (Data Structure)",
              "系统风险 (System Risk)",
              "复杂度 (Complexity)",
              "并发与锁 (Concurrency)",
              "零决策 (Zero-Decision)"
            ]
          },
          "check_item": { "type": "string", "description": "具体检查项" },
          "status": { "type": "string", "enum": ["Pass", "Warn", "Fail", "Locked", "Def"], "description": "审查状态" },
          "contract": { "type": "string", "description": "决策结论、规约或整改措施" }
        }
      }
    },
    "physical_changes": {
      "type": "array",
      "description": "Table 4: 物理变更预演表",
      "items": {
        "type": "object",
        "required": ["file_path", "location", "action", "summary", "minimalist_check", "ripple_effect"],
        "properties": {
          "file_path": { "type": "string", "description": "文件路径" },
          "location": { "type": "string", "description": "具体函数/行号" },
          "action": { "type": "string", "enum": ["Create", "Modify", "Delete"], "description": "操作类型" },
          "summary": { "type": "string", "description": "修改目的与内容简述" },
          "minimalist_check": { "type": "string", "description": "最小化验证" },
          "ripple_effect": { "type": "string", "description": "涟漪效应" }
        }
      }
    }
  }
}
